<html xmlns:th="https://www.thymeleaf.org"
      th:fragment="plantilla(cuerpo)">
    <head>
        <title>Gestion de usuarios</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/lumen/bootstrap.min.css">
        <style>
            body{
                background: rgba(212,228,239,1);
                background: -moz-linear-gradient(top, rgba(212,228,239,1) 0%, rgba(134,174,204,1) 100%) fixed;
                background: -webkit-gradient(left top, left bottom, color-stop(0%, rgba(212,228,239,1)), color-stop(100%, rgba(134,174,204,1))) fixed;
                background: -webkit-linear-gradient(top, rgba(212,228,239,1) 0%, rgba(134,174,204,1) 100%) fixed;
                background: -o-linear-gradient(top, rgba(212,228,239,1) 0%, rgba(134,174,204,1) 100%) fixed;
                background: -ms-linear-gradient(top, rgba(212,228,239,1) 0%, rgba(134,174,204,1) 100%) fixed;
                background: linear-gradient(to bottom, rgba(212,228,239,1) 0%, rgba(134,174,204,1) 100%) fixed;
                filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#d4e4ef', endColorstr='#86aecc', GradientType=0 );
                padding-right:5%;
                padding-left:5%;
            }
            .container{
                align-self: center;
                /*background-color:rgb(209, 209, 209);*/
                background: linear-gradient(to bottom, rgba(212,228,239,1) 0%, rgba(134,174,204,1) 100%);
                margin-top:15px;
                border:1px solid gray;
                border-radius: 10px;
            }
            .modal-content{
                background: rgba(212,228,239,1);
                background: -moz-linear-gradient(top, rgba(212,228,239,1) 0%, rgba(134,174,204,1) 100%) fixed;
                background: -webkit-gradient(left top, left bottom, color-stop(0%, rgba(212,228,239,1)), color-stop(100%, rgba(134,174,204,1))) fixed;
                background: -webkit-linear-gradient(top, rgba(212,228,239,1) 0%, rgba(134,174,204,1) 100%) fixed;
                background: -o-linear-gradient(top, rgba(212,228,239,1) 0%, rgba(134,174,204,1) 100%) fixed;
                background: -ms-linear-gradient(top, rgba(212,228,239,1) 0%, rgba(134,174,204,1) 100%) fixed;
                background: linear-gradient(to bottom, rgba(212,228,239,1) 0%, rgba(134,174,204,1) 100%) fixed;
                filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#d4e4ef', endColorstr='#86aecc', GradientType=0 );
            }
        </style>
    </head>
    <body>
        <div class="container text-center">
            <th:block th:include="${cuerpo}"/>
        </div>
        <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
        <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap5.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/jquery-deserialize@2.0.0-rc1/src/jquery.deserialize.min.js"></script>        
        <script>
            function leerHtmlAjax(){
                $.ajax({
                    url:"ejercicio7/formulario",   //<--Ejecutamos del contra esta url
                    success: function(pHtml){    //<- Nos devuelven la respuesta. 
                        bootbox.dialog({
                            title: 'Formulario de registro',
                            size: "large",
                            message:pHtml
                        })
                    },
                    error: function(xhr, status, error) {
                      alert(xhr.responseText);
                    }
                });
            }
            function leerJson(){
                var pId = $("#buscarId").val();
                $.ajax({
                    url:"/ejercicio7/ajax/" + pId,   //<--Ejecutamos del contra esta url
                    dataType:"json",
                    success: function(pJson){ //busqueda super pellejera, si tengo tiempo deberia convertir todo a datatable pa una busqueda mejor
                        $("#listaClientes").html("");
                        var salida = $("<tr>");
                        $("<td>").html("").appendTo(salida);
                        $("<td>").html(pJson.firstName + " " +pJson.lastName + "<p>" + pJson.title + "</p>").appendTo(salida);
                        $("<td>").html(pJson.primaryAccount).appendTo(salida);
                        $("<td>").html(pJson.email + "<p>" + pJson.phone + "</p>").appendTo(salida);
                        $("<td>").html("<a href='/ejercicio7/'" + pJson.id +  
                            " class='btn btn-success'><i class='fas fa-edit fa-sm'></i></a>" +
                                "<a href='/ejercicio7/delete/'" +pJson.id + 
                            " class='btn btn-danger'><i class='fas fa-trash fa-sm'></i></a>"
                        ).appendTo(salida); //Se podria meter en un div display none los botones 
                        salida.appendTo("#listaClientes");
                        //alert("Funcionalidad en desarrollo");   //<- Nos devuelven la respuesta. 
                        //console.log(pJson); //Me falta ver como mostrar esto por pantalla
                    },
                    error: function (err){
                        bootbox.dialog({
                            title: 'Error en la busqueda',
                            message: "Usuario no encontrado"
                        });
                    }
                })
            }
        </script>
    </body>
</html>
