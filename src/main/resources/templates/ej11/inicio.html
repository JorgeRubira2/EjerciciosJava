<!doctype html>
<html xmlns:th="https://www.thymeleaf.org">
    <head>
        <title>Titulo</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/united/bootstrap.min.css"/>
        <style>
            .container{
                margin-top:20px;
            }
        </style>

    </head>
    <body>
        <div class="container">
            <div class="container">
                <div class="row">
                    <div class="col-4">

                        <a id="imagen" class="btn btn-dark">Subir imagen &nbsp;<i class="fas fa-images"></i></a>
                        <a href="/ej11" class="btn btn-secondary" title="Borrar filtros"><i class="fas fa-trash-alt"></i></a>
                    </div>
                    <div class="col-8">
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="barra" placeholder="p.ej.: árbol, montaña..." >
                            <a class="btn btn-dark" id="buscar"><i class="fas fa-search"></i></a>
                        </div>
                    </div>

                </div> 
                <hr/>
                <div class="row" >

                    <div style="margin-top:20px" th:each="imag:${imagen}" id="galeria" class="col-3">
                        <img th:src="|/ej11/descarga?imagen=${imag.nombre}|" th:title="${imag.descripcion}" th:alt="${imag.descripcion}" th:attr="onclick=|ampliar('/ej11/descarga?imagen=${imag.nombre}')|" width="100%"/>
                        <span th:text="${imag.descripcion}"></span>
                        <a th:attr="onclick=|borrar('${imag.id}')|" class='btn btn-danger'>Borrar</a>
                    </div>
                </div>
            </div>

            <div id="imgForm" style="display:none">
                <form action="/ej11/subir" method="post" enctype="multipart/form-data">
                    <label class="form-label" for="imag">Imagen:</label>
                    <input type="file" name="imag" accept="image/*" class="form-control"/>
                    <label class="form-label" for="descripcion">Descripción:</label>
                    <input type="text" name="descripcion" class="form-control"/>
                    <br>
                    <input type="submit" value="Guardar" class="btn btn-primary"/>
                </form>
            </div>

            <script src="https://code.jquery.com/jquery-3.6.0.js"></script>   
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.js"></script>          
            <script>
                $(document).ready(function () {
                    $("#imagen").click(imagenF);
                    $("#buscar").click(buscarB);
                });
                function imagenF() {
                    bootbox.dialog({
                        title: 'Nueva imagen',
                        message: $("#imgForm").html()
                    });
                }
                function ampliar(pUrl) {
                    bootbox.alert({
                        size: 'xl',
                        message: "<div style='text-align:center'><img src='" + pUrl + "' width='50%'/></div>"
                    });
                }
                function buscarB() {
                    var dir = window.location.href;
                     if (dir.includes("?")) {
                         window.location.href = window.location.href + " " + $("#barra").val()
                    } else {
                        window.location.href = "/ej11?descripcion=" + $("#barra").val();
                    }

                }
                function borrar(pID){
                    window.location.href="/ej11/borrar?id="+pID;
                }

            </script>

    </body>
</html>
