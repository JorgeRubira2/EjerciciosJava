<html xmlns:th="https://www.thymeleaf.org">
    <head>
        <title>Titulo</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
        <style>
            .cabecera{
                border:1px solid lightgrey;
            }
            .card{
                margin-top:5px;
            }
            .verde{
                background-color:lightgreen;
            }
            .naranja{
                background-color:rgb(243, 189, 89);
            }
            .rojo{
                background-color:rgb(247, 162, 162);
            }           
        </style>
    </head>
    <body>
        <div class="container-fluid">
            <div class="row align-items-center text-center cabecera">
                <div class="col-md-4 ">Story
                </div>
                <div class="col-md-4">
                    <div class="row cabecera">
                        <div class="col-md-12">Waiting
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 cabecera">Waiting
                        </div>
                        <div class="col-md-6 cabecera">Working
                        </div>
                    </div>
                </div>
                <div class="col-md-4">Done
                </div>
            </div>
            <div class="row align-items-center text-center">
                <div class="col-md-4 cabecera">
                    <button class="btn btn-primary btn-sm" onclick="addUser()" >Añadir tarea</button>
                </div>
                <div class="col-md-2">
                </div>
                <div class="col-md-2">
                </div>
                <div class="col-md-4">
                </div>
            </div>
            <div th:each="tar:${tareas}" class="row align-items-center text-center">
                <div th:if="${'Roadmap'.equals(tar.estado)}" class="col-md-4 roadmap">
                    <div class="card" th:classappend="
                                                ${tar.horasTrabajadas <= tar.horasEstimacion} ? 'verde' : 
                                                (${tar.horasTrabajadas < tar.horasEstimacion*2} ? 'naranja' : 'rojo')">
                        <div class="card-body">
                            <h6 th:if="${tar.propietario!=null}" th:utext="|<i class='fas fa-user'></i> ${tar.propietario}|" class="card-subtitle mb-2 text-muted"></h6>
                            <p class="card-text" th:text="${tar.descripcion}"></p>
                            <a class="btn-sm btn btn-success col-3" th:href="${'/ej04/kanban/modifica?codigo=' + tar.codigo + '&estado=waiting'}" ><i class="fas fa-arrow-right    "></i></a>
                            <a class="btn-sm btn btn-secondary col-3" th:href="${'/ej04/kanban/edita?codigo=' + tar.codigo}" >Editar tarea</a>
                            <a class="btn-sm btn btn-info col-3" th:href="${'/ej04/kanban/usuario?codigo=' + tar.codigo}" ><i class="fas fa-user"></i></a>
                            <footer th:text="|${tar.horasTrabajadas} / ${tar.horasEstimacion}|" class="blockquote-footer"></footer>
                        </div>
                    </div>
                </div>
                <div th:if="${'waiting'.equals(tar.estado)}" id="waiting" class="col-md-2 offset-md-4">
                    <div class="card" th:classappend="
                                                    ${tar.horasTrabajadas <= tar.horasEstimacion} ? 'verde' : 
                                                    (${tar.horasTrabajadas < tar.horasEstimacion*2} ? 'naranja' : 'rojo')">
                        <div class="card-body">
                            <h6 th:if="${tar.propietario!=null}" th:utext="|<i class='fas fa-user'></i> ${tar.propietario}|" class="card-subtitle mb-2 text-muted"></h6>
                            <p class="card-text" th:text="${tar.descripcion}"></p>
                            <a class="btn-sm btn btn-success col-3" th:href="${'/ej04/kanban/modifica?codigo=' + tar.codigo + '&estado=working'}" ><i class="fas fa-arrow-right    "></i></a>
                            <a class="btn-sm btn btn-secondary col-3" th:href="${'/ej04/kanban/edita?codigo=' + tar.codigo}" ><i class="fas fa-edit"></i></a>
                            <a class="btn-sm btn btn-info col-3" th:href="${'/ej04/kanban/usuario?codigo=' + tar.codigo}" ><i class="fas fa-user"></i></a>
                            <footer th:text="|${tar.horasTrabajadas} / ${tar.horasEstimacion}|" class="blockquote-footer"></footer>
                        </div>
                    </div>
                </div>
                <div th:if="${'working'.equals(tar.estado)}" id="working" class="col-md-2 offset-md-6">
                    <div class="card" th:classappend="
                                                    ${tar.horasTrabajadas <= tar.horasEstimacion} ? 'verde' : 
                                                    (${tar.horasTrabajadas < tar.horasEstimacion*2} ? 'naranja' : 'rojo')">
                        <div class="card-body">
                            <h6 th:if="${tar.propietario!=null}" th:utext="|<i class='fas fa-user'></i> ${tar.propietario}|" class="card-subtitle mb-2 text-muted"></h6>
                            <p class="card-text" th:text="${tar.descripcion}"></p>
                            <a class="btn-sm btn btn-info col-3" th:href="${'/ej04/kanban/modifica?codigo=' + tar.codigo + '&estado=waiting'}" ><i class="fas fa-arrow-left    "></i></a>
                            <a class="btn-sm btn btn-danger col-3" th:href="${'/ej04/kanban/modifica?codigo=' + tar.codigo + '&estado=done'}" ><i class="fas fa-check-circle    "></i></a>
                            <a class="btn-sm btn btn-info col-3" th:href="${'/ej04/kanban/usuario?codigo=' + tar.codigo}" ><i class="fas fa-user"></i></a>
                            <footer th:text="|${tar.horasTrabajadas} / ${tar.horasEstimacion}|" class="blockquote-footer"></footer>
                        </div>
                    </div>
                </div>
                <div th:if="${'done'.equals(tar.estado)}" id="done" class="col-md-4 offset-md-8">
                    <div class="card" th:classappend="
                                                    ${tar.horasTrabajadas <= tar.horasEstimacion} ? 'verde' : 
                                                    (${tar.horasTrabajadas < tar.horasEstimacion*2} ? 'naranja' : 'rojo')">
                        <div class="card-body">
                            <h6 th:if="${tar.propietario!=null}" th:utext="|<i class='fas fa-user'></i> ${tar.propietario}|" class="card-subtitle mb-2 text-muted"></h6>
                            <p class="card-text" th:text="${tar.descripcion}"></p>
                            <footer th:text="|${tar.horasTrabajadas} / ${tar.horasEstimacion}|" class="blockquote-footer"></footer>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div style="display:none" id="formuadd" class="container-fluid">
            <div class="row text-center">
                <form id="formu" th:object="${task}" action="/ej04/addtarea" method="POST">
                    <input type="hidden" th:field="*{codigo}" />
                    <label class="col-2">Descripcion:</label>
                    <textarea class="col-3" th:field="*{descripcion}" > </textarea>
                    <label class="col-2" >Tiempo estimado:</label>
                    <input min="0" class="col-3" type="number" th:field="*{horasEstimacion}" />
                    <label class="col-2" >Tiempo trabajado:</label>
                    <input min="0" class="col-3" type="number" th:field="*{horasTrabajadas}" />
                    <input type="submit"  value="Añadir" class="btn btn-primary col-6"/>        
                </form>
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
        <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.25/js/dataTables.bootstrap5.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/5.5.2/bootbox.js"></script>
        <script>
            $(function() {
                //document ready
            });

            function addUser(){
                bootbox.dialog({
                title:"Introduce los datos de la tarea",
                size: 'large',
                message: $('#formuadd').html(),               
                });
            }
        </script>
        <script th:if="${task.codigo!=null}">
            $(document).ready(function() {
                bootbox.dialog({
                    closeButton: false,
                    title:"Editar la tarea",
                    size: 'large',
                    message: $('#formuadd').html(),
                });
            });
        </script>
    </body>
</html>
